<template>
  <div class="overflow-x-auto">
    <table class="table-auto w-full border-collapse border border-gray-300">
      <thead class="bg-gray-200">
        <tr>
          <th class="border px-4 py-2">ID</th>
          <th class="border px-4 py-2">Status</th>
          <th class="border px-4 py-2">Percentage</th>
          <th class="border px-4 py-2">Last Collected</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="bin in bins" :key="bin.id">
          <td class="border px-4 py-2">{{ bin.id }}</td>
          <td class="border px-4 py-2">{{ bin.status }}</td>
          <td class="border px-4 py-2">{{ bin.percentage }}%</td>
          <td class="border px-4 py-2">{{ bin.lastCollected }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</template>

<script>
export default {
  data() {
    return {
      bins: [
        { id: '0001', status: 'Full', percentage: 90, lastCollected: '2024-11-18' },
        { id: '0002', status: 'Empty', percentage: 10, lastCollected: '2024-11-17' },
        { id: '0003', status: 'Half Full', percentage: 50, lastCollected: '2024-11-16' },
      ],
    }
  },

  mounted() {
    const sse = new EventSource('http://localhost:8080/events?stream=messages')
    sse.onmessage = this.updateTable
  },

  methods: {
    updateTable(event) {
      let binUpdate = event.data
      console.log(binUpdate)
      this.bins.forEach((item, index) => {
        if (item.id !== binUpdate['id']) {
          console.log(`${index}: ${item}`)
        }
      })
    },
  },
}
</script>

<style>
table {
  font-family: Arial, sans-serif;
}
</style>
